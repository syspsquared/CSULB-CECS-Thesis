\section{Print Servers} \label{sec:Print Servers}
\subsection{Overview}
At the core of every lab should be some sort of utility server.  This server should handle a variety of functions to serve the client machines in the lab.  In CECS labs, the most obvious function for these servers was printing, so we decided to call them print servers. We named them with the preface psvr followed by the room number.  Printing is described in Section~\ref{sec:printservers}.  The rest of the Print Server functionality consists of:  DHCP, TFTP, PXE boot, NFS, Samba, Norton Ghost (for windows), and to function as NIS slaves.
\subsection{DHCPD Server}
The DHCPD server functions to hand out IP addresses to the client machines in the lab.  The DHCPD has to be on the same subnet as the clients due to how DHCP addresses work.  Clients send a broadcast on the local subnet to request an IP, and DHCPD responds.  It is possible for this broadcast to escape the subnet, but that requires the router (or layer 3 switch) to use an IP helper protocol.  This protocol maps broadcast requests to their origin subnets so that answers can be returned.  In CECS labs, we prefer to keep DHCPD on the same subnet in the event that if connection outside the lab is lost, clients can still function locally.  

In addition, the DHCPD server must hand out addresses based on Mac addresses.  This is because IP addresses are mapped to hostnames in DNS.  Hostnames should match the labels listed on the client machines.  This way, if a problem with a client machine is reported, Tech Support knows both where the machine is physically and how to reach it over a network.  IP addresses should not be handed out randomly for normal operations (though it could be done for cloning if static addresses are assigned later).  

Alternatively, static addresses can be assigned on a per machine basis during the cloning process.  The advantage to this is the clients will be on the network regardless what happens to the DCHPD server.  The disadvantage to this is the cloning process will require someone to manually enter an IP for each client at some point, and this will break the ability to do fully automatic lab installs.   Regardless how IP addresses are handled during normal operations, dhcpd must be turned on during cloning to support TFTP and PXE for network booting.  
\subsection{Network Booting}
One of the most important uses of the print server is cloning the labs.  Full details for that are listed in the cloning section, but the print server side is described here.  The core part of the cloning requires the ability for clients to network boot (netboot) from the print server.  

Netbooting requires 3 things:  DHCP (listed above), TFTP, and PXE.You will also need NFS for the cloning process.  DHCP is required because the machines do not know who is who and require an IP address to get started.  After they have successfully netbooted, the IP address they have can be changed to the one they actually need or be mapped automatically with dhclient if the print server knows their MAC address.  
\pargraph
TFTP (Trivial File Transfer Protocol) is required for loading the initial boot image.  TFTP has very little security and must be highly restricted on the print server.  It has no authentication and only allows downloading of specific files.  This is necessary because during netboot, clients do not have any sort of identification or credentials that they can use.  TFTP is only used for the loading of the boot image initrd (a ram disk) and associated configuration files used by PXE.  The lab image to clone with is transferred with NFS after the machine has fully booted.  

DHCP and TFTP are used to support PXE (Pre-boot Execution Environment).  This is the protocol used to support netbooting without the help of any storage device on the client.  Clients will go out and grab an IP from DCHP, then download a file listed in the Print Server's dhcpd.conf file.  That file (usually called pxelinux.0 or something similar) is then downloaded and executed.  It gets its configuration files, loads the ram disk containing the network boot filesystem, and loads the kernel.  From there, it is then usable as a stripped down Linux OS run fully from memory.  It can then be used to both create the master lab image and deploy the clones.  It can also be used to troubleshoot where a full installation is not available (though tools are limited to the size of the ram disk).
\subsection{Network File System}
The Print Servers also mount NFS shares from the core fileservers.  It uses automount for this because automount will periodically check if the mount fails and attempt a remount.  Linux clients can mount the Print Server shares, thus making them a relay.  However, we have found it easier to just authorize all lab subnets to mount the core server shares directly instead of using a Print Server as a middleman.  

\subsection{Samba Support}
Since the file servers are all Linux based with clients mounting via NFS, some compatibility is needed for Windows Clients to mount those shares.  Windows uses its own network file system called SMB (Samba).  This is not compatible with Unix NFS natively.  Thus, a translation of sorts is needed.  The Print Server handles this by mounting the NFS shares from the core servers and running a samba server that acts as a middleman for the Windows servers to mount.  The Samba server requires a fair amount of CPU and memory resources to do on-the-fly translation of NFS to Samba. As a result, we have equipped the Print Servers in the Windows labs to have quad core processors that can handle a large classroom full of Windows SMB file requests. These would not be necessary if Windows could natively mount NFS. Supposedly, they can in certain versions of Windows 7, but we have been unable to make it work.

\subsection{Norton Ghost:  Windows Alternative}
For installing Microsoft Windows, a Linux network boot image is insufficient.  Instead, a tool called Norton Ghost is booted by all the clients and used to do a byte by byte copy of the Windows image to all the Windows clones.  This tool is proprietary and its workings are held secret by the Symmantec corporation (it is free to use though).  However, it is useful for Windows administrators who may not necessarily know Linux that well.  One advantage it has is the use of multicast to send the image to all clients at once instead of one at a time.  The disadvantage to this is that if a client misses a packet, it must be cloned again.  An alternative to using Norton Ghost is just netbooting to Linux and using dd to do a binary copy of the Windows image.  This would be problematic on hard drives of different sizes as the image could only be the size of the smallest hard drive used in order to remain compatible.  

\subsection{NIS Slave}
Print servers are important for authentication because they provide NIS information to the rest of the lab.  The core server holding the NIS namemaster does not grant login information to all machines.  Instead, it designates each Print Server in a lab as an NIS slave.  This way, the Print Servers themselves can authorize the clients under them.  This hierarchy grants obvious advantages to administrators, especially if the administrators themselves have a hierarchy.  
